language: python

install:
  - pip install -r requirements.txt

script:
  - chmod +x build.sh
  - ./build.sh
  - ls -R

jobs:
  include:
    - stage: build macOS binary
      os: osx
      language: generic
      sudo: required
      if: tag IS present
      before_deploy:
        - tar -cvf dist/CNKI-Converter-macOS.app.tar dist/CNKI-Converter-darwin.app
      deploy:
        provider: releases
        api_key: $GITHUB_OATU_TOKEN
        file: dist/**/*.tar
        file_glob: true
        skip_cleanup: true
    - stage: build Windows binary
      os: windows
      language: sh
      if: tag IS present
      before_install:
        - choco install python --version=3.7.4
        - export PATH="/c/Python37:/c/Python37/Scripts:$PATH"
      deploy:
        provider: releases
        api_key: $GITHUB_OATU_TOKEN
        file: dist/**/*.exe
        file_glob: true
        skip_cleanup: true
